<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mente Jovem - Quiz Emocional</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Quiz Emocional - Mente Jovem</h1>
        <p>ğŸ§¡ Este Ã© um espaÃ§o seguro. Responda com sinceridade. NÃ£o Ã© uma prova, nÃ£o tem certo ou errado. Isso nos ajuda a entender como vocÃª estÃ¡ se sentindo. âœ… Leva menos de 2 minutos.</p>
        <form id="quizForm">
            <div id="questions">
                <!-- As perguntas serÃ£o inseridas dinamicamente via JavaScript -->
            </div>
            <button type="submit">Enviar Respostas</button>
        </form>
        <div id="result" style="display: none;">
            <h2>Resultado</h2>
            <p id="resultText"></p>
            <p id="resultEmoji"></p>
            <div id="actionButton"></div>
            <button onclick="resetQuiz()">Refazer o Quiz</button>
        </div>
    </div>
    <script type="module">
        import { saveResultToFirebase } from './script.js';

        const questions = [
            "VocÃª sente que estÃ¡ carregando algo pesado por dentro, mesmo sem saber explicar o motivo?",
            "JÃ¡ sentiu que ninguÃ©m entenderia se vocÃª contasse o que estÃ¡ passando?",
            "Tem dificuldade para dormir ou dormir demais nos Ãºltimos dias?",
            "VocÃª tem chorado ou se sentido muito triste sem saber por quÃª?",
            "Tem perdido o interesse em coisas que normalmente gosta de fazer?",
            "Tem sentido seu coraÃ§Ã£o acelerar ou ficar nervoso sem um motivo claro?",
            "JÃ¡ pensou em desaparecer ou que o mundo seria melhor sem vocÃª?",
            "VocÃª tem alguÃ©m com quem se sente seguro para conversar sobre seus sentimentos?",
            "EstÃ¡ se sentindo sozinho, mesmo estando entre outras pessoas?",
            "EstÃ¡ tudo bem de verdade com vocÃªâ€¦ ou vocÃª apenas diz que estÃ¡ para nÃ£o preocupar ninguÃ©m?"
        ];

        const quizForm = document.getElementById('quizForm');
        const questionsDiv = document.getElementById('questions');
        const resultDiv = document.getElementById('result');
        const resultText = document.getElementById('resultText');
        const resultEmoji = document.getElementById('resultEmoji');
        const actionButton = document.getElementById('actionButton');

        // Gera as perguntas dinamicamente
        questions.forEach((question, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.innerHTML = `
                <p>${index + 1}. ${question}</p>
                <label><input type="radio" name="q${index}" value="1" required> ğŸ˜ƒ Nunca</label>
                <label><input type="radio" name="q${index}" value="2"> ğŸ˜ Raramente</label>
                <label><input type="radio" name="q${index}" value="3"> ğŸ˜¶ Ã€s vezes</label>
                <label><input type="radio" name="q${index}" value="4"> ğŸ˜Ÿ Frequentemente</label>
                <label><input type="radio" name="q${index}" value="5"> ğŸ˜¢ Quase sempre</label>
            `;
            questionsDiv.appendChild(questionDiv);
        });

        quizForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            let score = 0;
            let q7Score = 0;
            for (let i = 0; i < questions.length; i++) {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                if (selected) {
                    const value = parseInt(selected.value);
                    score += value;
                    if (i === 6) q7Score = value; // Pergunta 7
                }
            }

            let result = '';
            let emoji = '';
            let action = '';
            let classification = '';

            if (q7Score >= 4) {
                classification = 'Vermelho';
                result = 'VocÃª nÃ£o estÃ¡ sozinho. Seu sentimento importa e queremos conversar com vocÃª agora. Vamos cuidar disso juntos. â¤ï¸';
                emoji = 'ğŸ˜¢';
                action = `<a href="https://calendly.com/mente-jovem/terapeuta">Falar agora com alguÃ©m por vÃ­deo</a><br><p>Se vocÃª estiver em risco imediato, tambÃ©m pode buscar ajuda com um adulto de confianÃ§a ou ligar para o 188 (CVV).</p>`;
                await saveResultToFirebase(score, classification);
                resultText.innerHTML = result;
                resultEmoji.innerHTML = emoji;
                actionButton.innerHTML = action;
                resultDiv.style.display = 'block';
                quizForm.style.display = 'none';
            } else if (score <= 20) {
                classification = 'Verde';
                await saveResultToFirebase(score, classification);
                window.location.href = 'student_dashboard.html';
            } else if (score <= 34) {
                classification = 'Amarelo';
                await saveResultToFirebase(score, classification);
                window.location.href = 'student_dashboard.html';
            } else {
                classification = 'Vermelho';
                result = 'VocÃª nÃ£o estÃ¡ sozinho. Seu sentimento importa e queremos conversar com vocÃª agora. Vamos cuidar disso juntos. â¤ï¸';
                emoji = 'ğŸ˜¢';
                action = `<a href="https://calendly.com/mente-jovem/terapeuta">Falar agora com alguÃ©m por vÃ­deo</a><br><p>Se vocÃª estiver em risco imediato, tambÃ©m pode buscar ajuda com um adulto de confianÃ§a ou ligar para o 188 (CVV).</p>`;
                await saveResultToFirebase(score, classification);
                resultText.innerHTML = result;
                resultEmoji.innerHTML = emoji;
                actionButton.innerHTML = action;
                resultDiv.style.display = 'block';
                quizForm.style.display = 'none';
            }
        });

        function resetQuiz() {
            quizForm.reset();
            resultDiv.style.display = 'none';
            quizForm.style.display = 'block';
        }
    </script>
</body>
</html>
